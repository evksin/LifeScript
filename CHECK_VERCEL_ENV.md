# Проверка переменных окружения на Vercel

## Проблема: На Vercel нет формы Google и можно войти без авторизации

Это означает, что **переменные окружения не настроены** или **не загружаются** на Vercel.

## Шаг 1: Проверка переменных окружения на Vercel

1. Откройте [Vercel Dashboard](https://vercel.com/dashboard)
2. Выберите ваш проект
3. Перейдите в **Settings** → **Environment Variables**
4. Проверьте, что добавлены **ВСЕ** переменные:

   - ✅ `DATABASE_URL`
   - ✅ `GOOGLE_CLIENT_ID`
   - ✅ `GOOGLE_CLIENT_SECRET`
   - ✅ `AUTH_SECRET`

5. Убедитесь, что переменные добавлены для **Production**, **Preview** и **Development**

## Шаг 2: Пересборка проекта

После добавления/изменения переменных окружения **ОБЯЗАТЕЛЬНО** пересоберите проект:

### Вариант 1: Через Dashboard
1. Vercel Dashboard → ваш проект → **Deployments**
2. Найдите последний деплой
3. Нажмите **"..."** (три точки) → **"Redeploy"**
4. Выберите **"Use existing Build Cache"** = **No** (чтобы пересобрать с новыми переменными)

### Вариант 2: Через Git
```powershell
git commit --allow-empty -m "Пересборка для переменных окружения"
git push
```

## Шаг 3: Проверка логов деплоя

1. Vercel Dashboard → ваш проект → **Deployments** → последний деплой
2. Откройте **"Build Logs"**
3. Ищите ошибки, связанные с:
   - `GOOGLE_CLIENT_ID`
   - `AUTH_SECRET`
   - `DATABASE_URL`

## Шаг 4: Проверка работы авторизации

После пересборки:

1. Откройте `https://your-domain.vercel.app/login`
2. **Должна появиться форма** с кнопкой "Войти через Google"
3. Если формы нет - проверьте логи в браузере (F12 → Console)

## Шаг 5: Проверка middleware

1. Откройте `https://your-domain.vercel.app/dashboard` **без авторизации**
2. **Должно перенаправить** на `/login`
3. Если не перенаправляет - middleware не работает

## Возможные причины проблем

### 1. Переменные окружения не добавлены
**Решение:** Добавьте все переменные на Vercel

### 2. Переменные добавлены, но проект не пересобран
**Решение:** Пересоберите проект (см. Шаг 2)

### 3. Неправильные значения переменных
**Решение:** Проверьте, что значения совпадают с локальными (кроме DATABASE_URL, который может быть другим)

### 4. Redirect URI не добавлен в Google Console
**Решение:** Добавьте `https://your-domain.vercel.app/api/auth/callback/google` в Google Console

## Быстрая проверка

Выполните в терминале (для проверки локально):
```powershell
# Проверьте, что переменные есть в .env.local
Get-Content .env.local | Select-String -Pattern "GOOGLE|AUTH"
```

Если переменных нет - добавьте их в `.env.local`.

